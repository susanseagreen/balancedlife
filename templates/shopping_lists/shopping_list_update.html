{% extends 'base.html' %}
{% load static crispy_forms_tags get_display %}

{% block container %}

    <div id="myModal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5">

        <div class="row">
            <div class="col">

                <form method="post" action="{% url 'shopping_lists:update' pk %}">
                    {% csrf_token %}
                    <fieldset>
                        {% crispy form %}
                    </fieldset>
                </form>

                <div class="d-flex justify-content-center">
                    <a class="modal_create_recipe btn btn-dark m-1" data-toggle="modal" href="javascript:void(0);">
                        Add Recipe Ingredients
                    </a>
                    <a class="modal_create_ingredient btn btn-dark m-1" data-toggle="modal" href="javascript:void(0);">
                        Add Other Ingredient
                    </a>
                </div>

                <br>

                <table class="table m-0 table-bordered">
                    {% for id, ingredient in ingredient_list.items %}
                        <tr>
                            <td class="p-0" style="width: 100px">
                                <a class="cursor-pointer" title="See More"
                                   onclick="return showItems(this,'{{ ingredient.id }}')">
                                    <table class="table m-0 table-borderless">
                                        <tr>
                                            <td style="width: 100px">
                                                {% if ingredient.i %}{{ ingredient.i | no_decimals }}{% endif %}
                                                {% if ingredient.g %}{{ ingredient.g | no_decimals }}g{% endif %}
                                                {% if ingredient.kg %}{{ ingredient.kg | no_decimals }}kg{% endif %}
                                                {% if ingredient.dp %}{{ ingredient.dp | no_decimals }} pinch /
                                                    dash{% endif %}
                                                {% if ingredient.tsp %}{{ ingredient.tsp | no_decimals }} tsp{% endif %}
                                                {% if ingredient.tbsp %}{{ ingredient.tbsp | no_decimals }}
                                                    Tbsp{% endif %}
                                                {% if ingredient.c %}{{ ingredient.c | no_decimals }} cups{% endif %}
                                                {% if ingredient.l %}{{ ingredient.l | no_decimals }} litres{% endif %}
                                            </td>
                                            <td>{{ ingredient.ingredient_name }}</td>
                                        </tr>
                                    </table>
                                </a>
                            </td>
                        <tr>
                            <td colspan="2" class="p-0">
                                <div style='width:100%;display:none;' id='d_{{ ingredient.id }}'>
                                    <table class="table m-0 table-borderless small">
                                        {% for added in ingredient.added %}
                                            <tr>
                                                <td style="width: 100px">
                                                    <a class="modal_update_ingredient" data-toggle="modal"
                                                       href="javascript:void(0);"
                                                       id="{% url 'shopping_list_items:update_ingredient_modal' added.id %}">
                                                        {% if added.measurement_value or added.measurement_type %}
                                                            {% if added.measurement_value %}
                                                                {{ added.measurement_value | no_decimals }}
                                                            {% endif %}
                                                            {% if added.measurement_type %}
                                                                {{ added.measurement_type | measurement_type_display }}
                                                            {% endif %}
                                                        {% else %}
                                                            -
                                                        {% endif %}
                                                    </a>
                                                </td>
                                                <td>{{ added.code_recipe_ingredient__code_recipe__name }}</td>
                                            </tr>
                                        {% endfor %}
                                        {% for removed in ingredient.removed %}
                                            <tr>
                                                <td style="width: 100px">
                                                    <a class="modal_update_ingredient" data-toggle="modal"
                                                       href="javascript:void(0);" style="color: red"
                                                       id="{% url 'shopping_list_items:update_ingredient_modal' removed.id %}">
                                                        {% if removed.measurement_value or added.measurement_type %}
                                                            {% if removed.measurement_value %}
                                                                {{ removed.measurement_value | no_decimals }}
                                                            {% endif %}
                                                            {% if removed.measurement_type %}
                                                                {{ removed.measurement_type | measurement_type_display }}
                                                            {% endif %}
                                                        {% else %}
                                                            -
                                                        {% endif %}
                                                    </a>
                                                </td>
                                                <td>
                                                    {% if removed.code_recipe_ingredient__code_recipe__name %}
                                                        Recipe: {{ removed.code_recipe_ingredient__code_recipe__name }}
                                                    {% endif %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </table>

            </div>
        </div>

    </div>

    <script>
        $(document).ready(function () {
            jQuery('.modal_create_recipe').click(function (e) {
                $('.modal-body').load("{% url 'shopping_list_items:create_recipe_modal' pk %}", function (result) {
                    $('#myModal').modal({show: true});
                });
            });
            jQuery('.modal_create_ingredient').click(function (e) {
                $('.modal-body').load("{% url 'shopping_list_items:create_ingredient_modal' pk %}", function (result) {
                    $('#myModal').modal({show: true});
                });
            });
            jQuery('.modal_update_ingredient').click(function (e) {
                var linkvar = $(this).attr('id');
                $('.modal-body').load(linkvar, function (result) {
                    $('#myModal').modal({show: true});
                });
            });
        });
    </script>
    <script src="{% static 'javascript/showitems.js' %}"></script>

{% endblock container %}